---
import Filter from '@/components/Filter.astro';
import ThemeSwitcher from '@/components/ThemeSwitcher.astro';
import '@webtui/theme-nord';
import '@webtui/theme-catppuccin';
import '@webtui/theme-gruvbox';

const url = Astro.url;

let isOn: 'docs' | 'examples' | 'home' = 'docs';

if (url.pathname.startsWith('/examples')) {
  isOn = 'examples';
}

if (url.pathname === '/') {
  isOn = 'home';
}
---

<nav box-="square">
  <a href="/" id="home-link">
    &lt;/<span>#&gt;</span><span>WebTUI</span>
  </a>
  <row id="links">
    <a href="/start/intro" data-active={isOn === "docs"}>
      <span>&#xf15c</span>
      <span>Docs</span>
    </a>
    <a href="/examples" data-active={isOn === "examples"}>
      <span>&#xebeb</span>
      <span>Examples</span>
    </a>
    <a href="https://github.com/webtui/webtui" target="_blank">
      <span>&#xe709</span>
      <span>Github</span>
    </a>
    <button id="theme-button" size-="small">
      <span>&#xf042;</span>
      <span>Theme</span>
    </button>
    <button id="search-button" size-="small">
      <span>&#xea6d;</span>
      <span>Search</span>
    </button>
  </row>
</nav>
<Filter />
<ThemeSwitcher />

<style>
  nav {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    padding: 1lh 2ch;
    container-type: inline-size;
    container-name: navbar;
    white-space: nowrap;

    #home-link {
      text-decoration: none;
      font-weight: bold;
      color: var(--foreground1);

      span:first-of-type {
        color: #a6e3a1;
      }

      &:focus,
      &:hover {
        text-decoration: underline;
      }
    }
  }

  #links {
    row-gap: 2ch;
    column-gap: 1lh;

    a {
      display: inline-flex;
      gap: 1ch;
      text-decoration: none;
      color: var(--foreground2);

      &[data-active="true"] {
        color: var(--foreground0);
        font-weight: bold;
        text-decoration: underline;
      }

      &:focus,
      &:hover {
        text-decoration: underline;
      }
    }
  }

  #theme-button,
  #search-button {
    display: inline-flex;
    gap: 1ch;
  }

  @media (max-width: 84ch) {
    #links {
      gap: 1ch;

      a {
        background-color: var(--background1);
        padding: 0 1ch;
        span:last-of-type {
          display: none;
        }
      }
    }
  }

  @media (max-width: 54ch) {
    nav {
      align-items: normal;
      gap: 10px;
    }
  @media (max-width: 48ch) {
    #theme-button span:last-of-type,
    #search-button span:last-of-type {
      display: none;
    }
  }

  @media (max-width: 44ch) {
    nav {
      flex-direction: column;
    }
  }

  @layer base {
    html[data-webtui-theme="light"] {
      --background0: #fff;
      --background1: #ddd;
      --background2: #bbb;
      --background3: #999;

      --foreground0: #000;
      --foreground1: #444;
      --foreground2: #888;
    }

    html[data-webtui-theme="dark"] {
      --background0: #000;
      --background1: #222;
      --background2: #444;
      --background3: #666;

      --foreground0: #fff;
      --foreground1: #ccc;
      --foreground2: #999;
    }
  }
</style>

<script>
  import { isUserTyping } from "@/utils/vim";

  const searchDialog = document.getElementById(
    "search-dialog",
  ) as HTMLDialogElement;
  const themeDialog = document.getElementById(
    "theme-dialog",
  ) as HTMLDialogElement;

  document.getElementById("search-button")?.addEventListener("click", () => {
    searchDialog.showModal();
  });

  document.getElementById("theme-button")?.addEventListener("click", () => {
    themeDialog.showModal();
  });

  window.addEventListener("keydown", (e) => {
    if (isUserTyping()) return;

    if (e.key === "/") {
      e.preventDefault();
      searchDialog.showModal();
    }
  });
</script>
